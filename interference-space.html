<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Wave Field Visualization</title>
    <script src="https://cdn.jsdelivr.net/npm/p5@1.4.0/lib/p5.min.js"></script>
  </head>
  <body>

    <div>
      <label for="wavelengthSlider">Wavelength:</label>
      <input type="range" id="wavelengthSlider" min="20" max="300" value="100">
      <span id="wavelengthValue">100</span>

      <br>

      <label for="distanceSlider">Source Distance:</label>
      <input type="range" id="distanceSlider" min="50" max="600" value="240">
      <span id="distanceValue">240</span>

      <br>

      <label for="phaseShiftSlider">Phase Shift (radians):</label>
      <input type="range" id="phaseShiftSlider" min="-3.1416" max="3.1416" step="0.01" value="0">
      <span id="phaseShiftValue">0</span>

      <br>

      <label for="amplitudeRatioSlider">Amplitude Ratio (0.1 to 10):</label>
      <input type="range" id="amplitudeRatioSlider" min="-1" max="1" step="0.01" value="0">
      <span id="amplitudeRatioValue">1.0</span>

      <br>

      <label for="attenuationSlider">Distance Attenuation (0-3):</label>
      <input type="range" id="attenuationSlider" min="0" max="3" step="0.1" value="0">
      <span id="attenuationValue">0</span>

      <br>

      <label for="distanceScaleSlider">Distance Scale (0.01 to 5):</label>
      <input type="range" id="distanceScaleSlider" min="0.01" max="5" step="0.01" value="1">
      <span id="distanceScaleValue">1.00</span>
    </div>

    <script>

      let source1, source2;
      let wavelength = 100;
      let distanceBetweenSources = 240;
      let phaseShift = 0;
      let amplitudeRatio = 1;
      let attenuationPower = 0;
      let distanceScale = 1;
      let sourceDiameter = 20;

      function setup() {
          createCanvas(800, 600);
          colorMode(HSB, 360, 100, 100);
          noLoop();

          source1 = createVector(width / 2 - distanceBetweenSources / 2, height * 0.5);
          source2 = createVector(width / 2 + distanceBetweenSources / 2, height * 0.5);

          redrawField();

          document.getElementById('wavelengthSlider').addEventListener('input', function() {
              document.getElementById('wavelengthValue').innerText = this.value;
              redrawField();
          });

          document.getElementById('distanceSlider').addEventListener('input', function() {
              document.getElementById('distanceValue').innerText = this.value;
              redrawField();
          });

          document.getElementById('phaseShiftSlider').addEventListener('input', function() {
              document.getElementById('phaseShiftValue').innerText = this.value;
              redrawField();
          });

          document.getElementById('amplitudeRatioSlider').addEventListener('input', function() {
              let expValue = Math.pow(10, parseFloat(this.value));
              document.getElementById('amplitudeRatioValue').innerText = expValue.toFixed(2);
              redrawField();
          });

          document.getElementById('attenuationSlider').addEventListener('input', function() {
              document.getElementById('attenuationValue').innerText = this.value;
              redrawField();
          });

          document.getElementById('distanceScaleSlider').addEventListener('input', function() {
              document.getElementById('distanceScaleValue').innerText = parseFloat(this.value).toFixed(2);
              redrawField();
          });
      }

      function redrawField() {
          wavelength = parseFloat(document.getElementById('wavelengthSlider').value);
          distanceBetweenSources = parseFloat(document.getElementById('distanceSlider').value);
          phaseShift = parseFloat(document.getElementById('phaseShiftSlider').value);
          amplitudeRatio = Math.pow(10, parseFloat(document.getElementById('amplitudeRatioSlider').value));
          attenuationPower = parseFloat(document.getElementById('attenuationSlider').value);
          distanceScale = parseFloat(document.getElementById('distanceScaleSlider').value);

          source1 = createVector(width / 2 - distanceBetweenSources / 2, height * 0.5);
          source2 = createVector(width / 2 + distanceBetweenSources / 2, height * 0.5);
          maxAmplitude = (1.0 + amplitudeRatio) * Math.pow(0.5 * sourceDiameter * distanceScale, -attenuationPower);

          background(0, 0, 100);

          loadPixels();
          for (let x = 0; x < width; x++) {
              for (let y = 0; y < height; y++) {
                  let d1 = dist(x, y, source1.x, source1.y) * distanceScale;
                  let d2 = dist(x, y, source2.x, source2.y) * distanceScale;

                  let k = TWO_PI / wavelength;
                  let phase1 = k * d1 - phaseShift / 2;
                  let phase2 = k * d2 + phaseShift / 2;

                  let attenuation1 = (d1 !== 0) ? 1 / Math.pow(d1, attenuationPower) : 1;
                  let attenuation2 = (d2 !== 0) ? 1 / Math.pow(d2, attenuationPower) : 1;

                  let sumReal = attenuation1 * cos(phase1) + amplitudeRatio * attenuation2 * cos(phase2);
                  let sumImag = attenuation1 * sin(phase1) + amplitudeRatio * attenuation2 * sin(phase2);

                  let amplitude = sqrt(sumReal * sumReal + sumImag * sumImag) / (1 + amplitudeRatio);
                  let phase = atan2(sumImag, sumReal);

                  let hue = degrees(phase);
                  if (hue < 0) hue += 360;
                  let saturation = amplitude / maxAmplitude * 100;

                  let c = color(hue, saturation, 100);

                  let index = 4 * (x + y * width);
                  pixels[index] = red(c);
                  pixels[index+1] = green(c);
                  pixels[index+2] = blue(c);
                  pixels[index+3] = 255;
              }
          }
          updatePixels();

          drawSources();
      }

      function drawSources() {
          let k = TWO_PI / wavelength;

          let phase1 = k * 0 - phaseShift / 2;
          let hue1 = degrees(phase1);
          if (hue1 < 0) hue1 += 360;
          let c1 = color(hue1, 100, 100);

          let phase2 = k * 0 + phaseShift / 2;
          let hue2 = degrees(phase2);
          if (hue2 < 0) hue2 += 360;
          let c2 = color(hue2, 100, 100);

          noStroke();
          fill(c1);
          ellipse(source1.x, source1.y, sourceDiameter, sourceDiameter);
          stroke(0);
          noFill();
          ellipse(source1.x, source1.y, sourceDiameter, sourceDiameter);

          noStroke();
          fill(c2);
          ellipse(source2.x, source2.y, sourceDiameter, sourceDiameter);
          stroke(0);
          noFill();
          ellipse(source2.x, source2.y, sourceDiameter, sourceDiameter);
      }

    </script>
  </body>
</html>
